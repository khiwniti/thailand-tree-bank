{
  "name": "thailand-tree-bank",
  "description": "Thailand Government Tree Bank - LINE Mini App with PostgreSQL and Redis",
  "region": "asia-southeast1",
  "spec": {
    "kind": "Workflow",
    "spec": {
      "type": "service",
      "name": "thailand-tree-bank-deployment",
      "services": [
        {
          "name": "tree-bank-postgres",
          "type": "addon",
          "addonType": "postgresql",
          "version": "15",
          "plan": "starter",
          "storage": 1024,
          "backups": {
            "enabled": true,
            "schedule": "0 2 * * *"
          }
        },
        {
          "name": "tree-bank-redis",
          "type": "addon",
          "addonType": "redis",
          "version": "7",
          "plan": "starter"
        },
        {
          "name": "tree-bank-backend",
          "type": "service",
          "deployment": {
            "instances": 1,
            "docker": {
              "configType": "default",
              "context": "/backend",
              "dockerfile": "/backend/Dockerfile"
            }
          },
          "ports": [
            {
              "name": "api",
              "internalPort": 8080,
              "public": true,
              "protocol": "HTTP",
              "domains": []
            }
          ],
          "vcsData": {
            "projectUrl": "https://github.com/khiwniti/CarbonPlot",
            "projectType": "github",
            "accountLogin": "khiwniti",
            "projectName": "CarbonPlot",
            "ref": "master"
          },
          "buildSettings": {
            "dockerfile": {
              "buildEngine": "kaniko",
              "dockerFilePath": "/backend/Dockerfile",
              "dockerWorkDir": "/backend"
            }
          },
          "runtimeEnvironment": {
            "DATABASE_URL": "${sf.tree-bank-postgres.connectionString}",
            "REDIS_URL": "${sf.tree-bank-redis.connectionString}",
            "JWT_SECRET": "${secret.JWT_SECRET}",
            "LINE_CHANNEL_ID": "2008934197",
            "LINE_CHANNEL_SECRET": "${secret.LINE_CHANNEL_SECRET}",
            "PORT": "8080",
            "NODE_ENV": "production",
            "CORS_ORIGIN": "${link.tree-bank-frontend.host}",
            "MAX_FILE_SIZE": "10485760",
            "UPLOAD_DIR": "/app/uploads"
          },
          "healthCheck": {
            "path": "/health",
            "initialDelaySeconds": 30,
            "periodSeconds": 10
          },
          "resources": {
            "cpu": "0.2",
            "memory": "512"
          }
        },
        {
          "name": "tree-bank-frontend",
          "type": "service",
          "deployment": {
            "instances": 1,
            "docker": {
              "configType": "default",
              "context": "/src/line",
              "dockerfile": "/src/line/Dockerfile"
            }
          },
          "ports": [
            {
              "name": "http",
              "internalPort": 80,
              "public": true,
              "protocol": "HTTP",
              "domains": []
            }
          ],
          "vcsData": {
            "projectUrl": "https://github.com/khiwniti/CarbonPlot",
            "projectType": "github",
            "accountLogin": "khiwniti",
            "projectName": "CarbonPlot",
            "ref": "master"
          },
          "buildSettings": {
            "dockerfile": {
              "buildEngine": "kaniko",
              "dockerFilePath": "/src/line/Dockerfile",
              "dockerWorkDir": "/src/line"
            }
          },
          "buildArguments": {
            "VITE_LIFF_ID": "2008934197-jM9Zoogn",
            "VITE_OPENROUTER_API_KEY": "${secret.VITE_OPENROUTER_API_KEY}",
            "VITE_API_URL": "${link.tree-bank-backend.host}"
          },
          "healthCheck": {
            "path": "/health",
            "initialDelaySeconds": 10,
            "periodSeconds": 10
          },
          "resources": {
            "cpu": "0.1",
            "memory": "256"
          }
        }
      ],
      "secrets": [
        {
          "name": "JWT_SECRET",
          "description": "JWT secret for authentication (generate with: openssl rand -hex 32)"
        },
        {
          "name": "LINE_CHANNEL_SECRET",
          "description": "LINE Channel Secret from LINE Developers Console"
        },
        {
          "name": "VITE_OPENROUTER_API_KEY",
          "description": "OpenRouter API key for AI features",
          "value": "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"
        }
      ],
      "jobs": [
        {
          "name": "db-migrate",
          "service": "tree-bank-backend",
          "command": "npx prisma migrate deploy",
          "schedule": null,
          "runOnDeploy": true
        },
        {
          "name": "db-seed",
          "service": "tree-bank-backend",
          "command": "npx prisma db seed",
          "schedule": null,
          "runOnDeploy": false
        }
      ]
    }
  }
}
